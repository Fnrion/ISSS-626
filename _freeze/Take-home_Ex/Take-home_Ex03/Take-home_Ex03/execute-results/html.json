{
  "hash": "b1f4b955b90065554c278e5743fd0e2c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home_Ex03\"\nauthor: \"Zou Jiaxun\"\ndate: \"Nov 4, 2024\"\ndata-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n  cache: true\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Click to view code\"\neditor: \n  markdown: \n    wrap: sentence\n---\n\n\n\n# 1 Overview\n\n## 1.1 Background\n\nFinancial inclusion plays a vital role in promoting economic stability and growth, especially in developing economies like Tanzania.\nAccess to financial services empowers individuals, enabling them to save, borrow, insure, and invest, ultimately fostering resilience against economic shocks.\nDespite progress, challenges remain in ensuring that financial services reach all population segments, particularly those in rural and economically disadvantaged regions.\nFactors such as geographic location, socioeconomic status, and income sources contribute to disparities in financial access across Tanzania’s diverse regions.\n\nThe **FinScope Tanzania 2023 survey** provides comprehensive data on financial service uptake and barriers faced by Tanzanian adults.\nThis survey offers insights into various financial services, including banking, mobile money, insurance, and microfinance, as well as informal financial mechanisms.\nGiven Tanzania’s diverse agro-economic zones and urban-rural divide, financial inclusion determinants are expected to vary significantly by location.\nTo capture these spatial dynamics, this study employs **Geographically Weighted Regression (GWR)**, a statistical technique that models spatially varying relationships between variables.\nBy applying GWR, this analysis aims to uncover regional patterns in financial inclusion, thereby identifying localized factors influencing access to financial services across Tanzania.\n\n## 1.2 Objectives\n\nThe main objectives of this exercise are:\n\n-   **To assess the spatial variability of financial inclusion** across Tanzania, identifying how geographic location influences access to and usage of financial services.\n\n-   **To examine relationships between financial inclusion and socio-economic variables** such as income sources, urbanization level, and economic activity.\n    This includes understanding the role of mobile money, banking, and informal financial services across different regions.\n\n-   **To apply and interpret GWR in analyzing financial inclusion** by generating regional coefficients that highlight spatial patterns in the data, helping to pinpoint areas where specific financial services are more or less accessible.\n\n-   **To produce visualizations of GWR outputs**, including maps of local coefficients and R-squared values, to clearly communicate findings on regional disparities in financial inclusion.\n\nBy achieving these objectives, this analysis will contribute to a more nuanced understanding of financial inclusion in Tanzania, offering actionable insights for policymakers, financial service providers, and development organizations to address gaps in financial access.\n\n# 2 Data Wrangling\n\n## 2.1 Loading Packages\n\nTo prepare and analyze spatial data for Geographically Weighted Regression (GWR), we will use the following packages, which offer tools for geospatial data handling, data manipulation, visualization, and statistical analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, spgwr, tmap, tidyverse, dplyr, \n               ggplot2, GWmodel, readxl, knitr)\n\npackage_info <- data.frame(\n  Package = c(\n    \"sf\", \"spgwr\", \"tmap\", \"tidyverse\", \"dplyr\", \n    \"ggplot2\", \"readxl\", \"knitr\", \"GWmodel\"\n  ),\n  Description = c(\n    \"For importing, managing, and handling geospatial data, including shapefiles and CRS transformations.\",\n    \"For conducting Geographically Weighted Regression (GWR) analysis to examine spatially varying relationships.\",\n    \"For thematic mapping and creating visualizations to display spatial data and GWR results.\",\n    \"For data wrangling and analysis, providing a cohesive set of tools for data science tasks, including ggplot2 and tidyr.\",\n    \"For efficient data manipulation, including filtering, selecting, and summarizing data.\",\n    \"For creating additional custom and publication-ready visualizations.\",\n    \"For importing Excel files, useful for reading metadata or data dictionaries.\",\n    \"For dynamic report generation using LaTeX, HTML, and Markdown.\",\n    \"For conducting Geographically Weighted Regression (GWR) analysis to examing the model\"\n  )\n)\n\nknitr::kable(package_info, col.names = c(\"Package\", \"Description\"))\n```\n\n::: {.cell-output-display}\n\n\n|Package   |Description                                                                                                             |\n|:---------|:-----------------------------------------------------------------------------------------------------------------------|\n|sf        |For importing, managing, and handling geospatial data, including shapefiles and CRS transformations.                    |\n|spgwr     |For conducting Geographically Weighted Regression (GWR) analysis to examine spatially varying relationships.            |\n|tmap      |For thematic mapping and creating visualizations to display spatial data and GWR results.                               |\n|tidyverse |For data wrangling and analysis, providing a cohesive set of tools for data science tasks, including ggplot2 and tidyr. |\n|dplyr     |For efficient data manipulation, including filtering, selecting, and summarizing data.                                  |\n|ggplot2   |For creating additional custom and publication-ready visualizations.                                                    |\n|readxl    |For importing Excel files, useful for reading metadata or data dictionaries.                                            |\n|knitr     |For dynamic report generation using LaTeX, HTML, and Markdown.                                                          |\n|GWmodel   |For conducting Geographically Weighted Regression (GWR) analysis to examing the model                                   |\n\n\n:::\n:::\n\n\n\n## 2.2 Data Preparation\n\nWe will use the FinScope Tanzania 2023 data and the geoBoundaries Tanzania district shapefile for this analysis.\nThis section includes steps to import, clean, and prepare the data for Geographically Weighted Regression.\n\n::: panel-tabset\n## Aspatial Data\n\n**Survey Data**: Import and clean the FinScope survey data, focusing on financial inclusion indicators, socioeconomic variables, and regional identifiers.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvey_data <- read.csv(\"data/FinScope Tanzania 2023_Individual Main Data_FINAL.csv\")\n\n## summary(survey_data)\n\n# Select relevant columns for analysis\nsurvey_data <- survey_data %>%\n  select(reg_name, RU, MZ, MM, BANKED, MFI, PENSION, INSURANCE, SACCO, \n         OTHER_FORMAL, OVERALL_FORMAL, IncomeMain, BusO, \n         DEDICATED_FARMER, SMALLHOLDER_FARMER, population_wt, fasx, INFORMAL)\n\n# Check the cleaned data\nhead(survey_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       reg_name            RU       MZ     MM     BANKED     MFI     PENSION\n1        Mwanza         Rural Mainland     MM Not Banked Not MFI Not PENSION\n2        Kagera         Rural Mainland Not MM Not Banked Not MFI Not PENSION\n3         Mbeya   Other urban Mainland     MM Not Banked Not MFI Not PENSION\n4        Dodoma   Other urban Mainland     MM Not Banked Not MFI Not PENSION\n5 Dar es Salaam Dar es Salaam Mainland     MM Not Banked Not MFI Not PENSION\n6       Singida   Other urban Mainland     MM Not Banked Not MFI Not PENSION\n  INSURANCE     SACCO OTHER_FORMAL OVERALL_FORMAL                 IncomeMain\n1         0 Not SACCO OTHER_FORMAL OVERALL_FORMAL        Farmers and fishers\n2         0 Not SACCO OTHER_FORMAL OVERALL_FORMAL        Farmers and fishers\n3 INSURANCE Not SACCO OTHER_FORMAL OVERALL_FORMAL    Piece work/casual labor\n4         0 Not SACCO OTHER_FORMAL OVERALL_FORMAL Traders - non-agricultural\n5         0 Not SACCO OTHER_FORMAL OVERALL_FORMAL        Farmers and fishers\n6         0 Not SACCO OTHER_FORMAL OVERALL_FORMAL    Piece work/casual labor\n             BusO     DEDICATED_FARMER     SMALLHOLDER_FARMER population_wt\n1             nor Not Dedicated farmer Not Smallholder farmer      3191.110\n2             nor Not Dedicated farmer Not Smallholder farmer      3675.482\n3             nor Not Dedicated farmer Not Smallholder farmer      2043.709\n4 Business owners Not Dedicated farmer Not Smallholder farmer      4003.168\n5             nor Not Dedicated farmer Not Smallholder farmer      2618.941\n6             nor Not Dedicated farmer Not Smallholder farmer      4680.350\n                   fasx                                       INFORMAL\n1 Other formal non-bank INFORMAL incl SACCO AND CMG RISK CONTRIBUTIONS\n2 Other formal non-bank INFORMAL incl SACCO AND CMG RISK CONTRIBUTIONS\n3 Other formal non-bank INFORMAL incl SACCO AND CMG RISK CONTRIBUTIONS\n4 Other formal non-bank INFORMAL incl SACCO AND CMG RISK CONTRIBUTIONS\n5 Other formal non-bank INFORMAL incl SACCO AND CMG RISK CONTRIBUTIONS\n6 Other formal non-bank                                   Not INFORMAL\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbinary_vars <- c(\"BANKED\", \"MFI\", \"INSURANCE\", \"SACCO\", \"OTHER_FORMAL\", \"OVERALL_FORMAL\")\n\nsurvey_data <- survey_data %>%\n  mutate(\n    BANKED = ifelse(is.na(BANKED), 0, ifelse(BANKED == \"Banked\", 1, 0)),\n    MFI = ifelse(is.na(MFI), 0, ifelse(MFI == \"MFI\", 1, 0)),\n    INSURANCE = ifelse(is.na(INSURANCE), 0, ifelse(INSURANCE == \"INSURANCE\", 1, 0)),\n    SACCO = ifelse(is.na(SACCO), 0, ifelse(SACCO == \"SACCO\", 1, 0)),\n    OTHER_FORMAL = ifelse(is.na(OTHER_FORMAL), 0, ifelse(OTHER_FORMAL == \"OTHER_FORMAL\", 1, 0)),\n    OVERALL_FORMAL = ifelse(is.na(OVERALL_FORMAL), 0, ifelse(OVERALL_FORMAL == \"OVERALL_FORMAL\", 1, 0))\n  )\n\n# Check structure to verify transformations\nstr(survey_data[, c(\"BANKED\", \"MFI\", \"INSURANCE\", \"SACCO\", \"OTHER_FORMAL\", \"OVERALL_FORMAL\")])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t9915 obs. of  6 variables:\n $ BANKED        : num  0 0 0 0 0 0 0 0 1 0 ...\n $ MFI           : num  0 0 0 0 0 0 0 0 0 0 ...\n $ INSURANCE     : num  0 0 1 0 0 0 0 0 0 0 ...\n $ SACCO         : num  0 0 0 0 0 0 0 0 0 0 ...\n $ OTHER_FORMAL  : num  1 1 1 1 1 1 1 1 1 1 ...\n $ OVERALL_FORMAL: num  1 1 1 1 1 1 1 1 1 1 ...\n```\n\n\n:::\n\n```{.r .cell-code}\n# Calculate proportions by region\nregion_proportions <- survey_data %>%\n  group_by(reg_name) %>%\n  summarise(across(all_of(binary_vars), ~ mean(as.numeric(.), na.rm = TRUE), .names = \"prop_{col}\"))\n\nprint(region_proportions)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 31 × 7\n   reg_name     prop_BANKED prop_MFI prop_INSURANCE prop_SACCO prop_OTHER_FORMAL\n   <chr>              <dbl>    <dbl>          <dbl>      <dbl>             <dbl>\n 1 Arusha             0.298   0.105          0.137     0.00317             0.784\n 2 Dar es Sala…       0.437   0.159          0.215     0.0142              0.943\n 3 Dodoma             0.198   0.0951         0.180     0.0121              0.773\n 4 Geita              0.152   0.0365         0.0590    0.00281             0.753\n 5 Iringa             0.222   0.0711         0.138     0.00444             0.724\n 6 Kagera             0.132   0.0140         0.0588    0.0168              0.650\n 7 Kaskazini P…       0.175   0.0361         0.0567    0.00515             0.686\n 8 Kaskazini U…       0.167   0.0444         0.0278    0.0278              0.806\n 9 Katavi             0.211   0.0404         0.103     0.00448             0.776\n10 Kigoma             0.118   0.0112         0.0848    0.00670             0.569\n# ℹ 21 more rows\n# ℹ 1 more variable: prop_OVERALL_FORMAL <dbl>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save csv\nwrite.csv(survey_data, \"data/csv/survey_data.csv\", row.names = FALSE)\nwrite.csv(region_proportions, \"data/csv/region_proportions\", row.names = FALSE)\n```\n:::\n\n\n\n## Geospatial Data\n\nWe’ll use the district boundary shapefile (geoBoundaries-TZA-ADM2.shp) to perform spatial analysis.\nThis shapefile represents Tanzania’s districts and will be joined with the survey data.\n\nSince the district boundaries shapefile has `MULTIPOLYGON` geometries, we will convert them to `POLYGON` geometries to ensure compatibility with our analysis.\nWe’ll also add a new column for the area of each polygon, which could be useful for weighting or further spatial analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load and transform the ADM1 shapefile\nregions <- st_read(\"data/ADM1/geoBoundaries-TZA-ADM1.shp\") %>%\n  st_transform(crs = 32737)  # Using UTM Zone 37S for Tanzania\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `geoBoundaries-TZA-ADM1' from data source \n  `/Applications/SMU/S3/ISSS626 - Geo/ISSS-626 ZOUJIAXUN/Take-home_Ex/Take-home_Ex03/data/ADM1/geoBoundaries-TZA-ADM1.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 30 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 29.32698 ymin: -11.76125 xmax: 40.44556 ymax: -0.9854812\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 1: Convert MULTIPOLYGON to individual POLYGON components and calculate area\nregions_polygons <- regions %>%\n  st_cast(\"POLYGON\") %>%\n  mutate(area = st_area(.))\n\n# Step 2: Group by `shapeName` to ensure each region is represented as a single MULTIPOLYGON\nregions_cleaned <- regions_polygons %>%\n  group_by(shapeName) %>% \n  summarize(geometry = st_union(geometry), .groups = 'drop')\n\n# Check the result by plotting\nplot(st_geometry(regions_cleaned))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n:::\n\n## Merging Survey and Geospatial Data\n\nNow, with the POLYGON geometries and area calculated, we can merge this geospatial data with the survey data to create a combined dataset for the GWR analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Merge the survey data with the cleaned region shapefile using `shapeName` and `reg_name`\ncombined_data <- regions_cleaned %>%\n  left_join(region_proportions, by = c(\"shapeName\" = \"reg_name\"))\n\n# Check the combined dataset to confirm successful merge\nsummary(combined_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  shapeName                  geometry   prop_BANKED        prop_MFI      \n Length:30          MULTIPOLYGON : 6   Min.   :0.1092   Min.   :0.01116  \n Class :character   POLYGON      :24   1st Qu.:0.1321   1st Qu.:0.04930  \n Mode  :character   epsg:32737   : 0   Median :0.1984   Median :0.06984  \n                    +proj=utm ...: 0   Mean   :0.2015   Mean   :0.06676  \n                                       3rd Qu.:0.2222   3rd Qu.:0.08000  \n                                       Max.   :0.4370   Max.   :0.15854  \n                                       NA's   :5        NA's   :5        \n prop_INSURANCE      prop_SACCO       prop_OTHER_FORMAL prop_OVERALL_FORMAL\n Min.   :0.02308   Min.   :0.000000   Min.   :0.5692    Min.   :0.5810     \n 1st Qu.:0.07500   1st Qu.:0.004184   1st Qu.:0.6692    1st Qu.:0.6769     \n Median :0.10460   Median :0.006757   Median :0.7619    Median :0.7711     \n Mean   :0.10691   Mean   :0.012092   Mean   :0.7381    Mean   :0.7448     \n 3rd Qu.:0.13380   3rd Qu.:0.014228   3rd Qu.:0.7841    3rd Qu.:0.7950     \n Max.   :0.21545   Max.   :0.059859   Max.   :0.9431    Max.   :0.9451     \n NA's   :5         NA's   :5          NA's   :5         NA's   :5          \n```\n\n\n:::\n\n```{.r .cell-code}\nstr(combined_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nsf [30 × 8] (S3: sf/tbl_df/tbl/data.frame)\n $ shapeName          : chr [1:30] \"Arusha\" \"Dar es Salaam\" \"Dodoma\" \"Geita\" ...\n $ geometry           :sfc_GEOMETRY of length 30; first list element: List of 1\n  ..$ : num [1:208, 1:2] 322668 320915 317794 314638 313041 ...\n  ..- attr(*, \"class\")= chr [1:3] \"XY\" \"POLYGON\" \"sfg\"\n $ prop_BANKED        : num [1:30] 0.298 0.437 0.198 0.152 0.222 ...\n $ prop_MFI           : num [1:30] 0.1048 0.1585 0.0951 0.0365 0.0711 ...\n $ prop_INSURANCE     : num [1:30] 0.137 0.215 0.18 0.059 0.138 ...\n $ prop_SACCO         : num [1:30] 0.00317 0.01423 0.01215 0.00281 0.00444 ...\n $ prop_OTHER_FORMAL  : num [1:30] 0.784 0.943 0.773 0.753 0.724 ...\n $ prop_OVERALL_FORMAL: num [1:30] 0.784 0.945 0.773 0.753 0.738 ...\n - attr(*, \"sf_column\")= chr \"geometry\"\n - attr(*, \"agr\")= Factor w/ 3 levels \"constant\",\"aggregate\",..: NA NA NA NA NA NA NA\n  ..- attr(*, \"names\")= chr [1:7] \"shapeName\" \"prop_BANKED\" \"prop_MFI\" \"prop_INSURANCE\" ...\n```\n\n\n:::\n:::\n\n\n\nRemove rows with NA values in the relevant columns\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_data <- combined_data %>%\n  drop_na(prop_BANKED, prop_MFI, prop_INSURANCE, prop_SACCO)\n```\n:::\n\n\n\n# 3 Geospatial Analysis with GWR\n\n## 3.1 Exploratory Spatial Data Analysis (ESDA)\n\nCreate choropleth maps to visualize the distribution of each financial inclusion indicator across regions.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\") \n\n# Define each map individually\nmap1 <- tm_shape(combined_data) +\n  tm_polygons(\"prop_BANKED\", \n              title = \"Proportion of Banked Population\",\n              palette = \"Blues\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"Banked Population by Region\", main.title.size = 1)\n\nmap2 <- tm_shape(combined_data) +\n  tm_polygons(\"prop_MFI\", \n              title = \"Proportion of MFI Users\",\n              palette = \"Purples\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"MFI Users by Region\", main.title.size = 1)\n\nmap3 <- tm_shape(combined_data) +\n  tm_polygons(\"prop_INSURANCE\", \n              title = \"Proportion of Insurance Users\",\n              palette = \"Greens\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"Insurance Users by Region\", main.title.size = 1)\n\nmap4 <- tm_shape(combined_data) +\n  tm_polygons(\"prop_SACCO\", \n              title = \"Proportion of SACCO Users\",\n              palette = \"Oranges\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"SACCO Users by Region\", main.title.size = 1)\n\nmap5 <- tm_shape(combined_data) +\n  tm_polygons(\"prop_OTHER_FORMAL\", \n              title = \"Proportion of Other Formal Financial Users\",\n              palette = \"Reds\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"Other Formal Financial Users by Region\", main.title.size = 1)\n\nmap6 <- tm_shape(combined_data) +\n  tm_polygons(\"prop_OVERALL_FORMAL\", \n              title = \"Proportion of Overall Formal Financial Inclusion\",\n              palette = \"YlGnBu\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"Overall Formal Financial Inclusion by Region\", main.title.size = 1)\n\n# Arrange maps in a 2x3 grid\ntmap_arrange(map1, map2, map3, map4, map5, map6, ncol = 3, nrow = 2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n## 3.2 Preparing for Geographically Weighted Regression (GWR)\n\nUse GWR to explore the spatial variability in financial inclusion, the prop\\_\\* columns can be used as dependent or independent variables in model.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set up coordinates and calculate bandwidth\ncoords <- st_coordinates(st_centroid(combined_data))\ngwr_bandwidth <- bw.gwr(prop_BANKED ~ prop_MFI + prop_INSURANCE + prop_SACCO, \n                        data = combined_data, \n                        approach = \"AICc\", \n                        kernel = \"bisquare\", \n                        adaptive = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAdaptive bandwidth (number of nearest neighbours): 23 AICc value: -51.36172 \nAdaptive bandwidth (number of nearest neighbours): 22 AICc value: -49.6069 \nAdaptive bandwidth (number of nearest neighbours): 24 AICc value: -53.01621 \nAdaptive bandwidth (number of nearest neighbours): 24 AICc value: -53.01621 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Run GWR model without specifying `coords`, as they are embedded in `combined_data`\ngwr_model <- gwr.basic(prop_BANKED ~ prop_MFI + prop_INSURANCE + prop_SACCO, \n                       data = combined_data, \n                       bw = gwr_bandwidth, \n                       kernel = \"bisquare\", \n                       adaptive = TRUE)\n```\n:::\n\n\n\nCheck the summary of the GWR model to view the results, including coefficients, local R-squared values, and diagnostics.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Print summary of GWR model results\nsummary(gwr_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Length Class  Mode\nGW.arguments  11     -none- list\nGW.diagnostic  8     -none- list\nlm            14     lm     list\nSDF           19     sf     list\ntimings        5     -none- list\nthis.call      6     -none- call\nFtests         0     -none- list\n```\n\n\n:::\n:::\n\n\n\nThe coefficients and local R-squared values can help to understand the spatial variation in the relationship between prop_BANKED and your predictors.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract coefficient estimates and local R-squared values\ngwr_results <- as.data.frame(gwr_model$SDF)  # Convert Spatial Data Frame to regular Data Frame\nhead(gwr_results)  # View first few rows to check the data structure\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Intercept  prop_MFI prop_INSURANCE prop_SACCO         y      yhat\n1 0.04278466 0.8314447      0.8944337 -0.8296852 0.2984127 0.2493518\n2 0.06504168 0.9134198      0.8593806 -1.1239781 0.4369919 0.3790117\n3 0.02530920 0.8963779      0.9255787 -0.5375104 0.1983806 0.2708177\n4 0.06879238 0.8053858      0.6608077 -0.5112866 0.1516854 0.1357466\n5 0.05688544 0.7905976      0.8113619 -0.3155218 0.2222222 0.2234910\n6 0.06897307 0.8129905      0.6697867 -0.5857415 0.1316527 0.1099143\n      residual CV_Score Stud_residual Intercept_SE prop_MFI_SE\n1  0.049060939        0    1.02617289   0.03613565   0.6639298\n2  0.057980179        0    2.26262510   0.04384599   0.7471723\n3 -0.072437148        0   -1.58603717   0.04089960   0.7261918\n4  0.015938823        0    0.30388209   0.03802964   0.6703635\n5 -0.001268799        0   -0.02606759   0.04228120   0.6839875\n6  0.021738349        0    0.49758427   0.03828892   0.6707030\n  prop_INSURANCE_SE prop_SACCO_SE Intercept_TV prop_MFI_TV prop_INSURANCE_TV\n1         0.4882944      1.125925     1.184001    1.252308          1.831751\n2         0.4937246      1.045385     1.483413    1.222502          1.740607\n3         0.5130715      1.054263     0.618813    1.234354          1.803996\n4         0.4851896      1.045673     1.808915    1.201416          1.361958\n5         0.4702472      1.167463     1.345407    1.155865          1.725394\n6         0.4877893      1.067588     1.801384    1.212147          1.373107\n  prop_SACCO_TV  Local_R2                       geometry\n1    -0.7368919 0.7526119 POLYGON ((322667.9 9679662,...\n2    -1.0751810 0.6471317 MULTIPOLYGON (((601932.5 92...\n3    -0.5098447 0.6782635 POLYGON ((91973.24 9464524,...\n4    -0.4889547 0.8452564 POLYGON ((-372724.1 9626877...\n5    -0.2702628 0.6426588 POLYGON ((18635.87 9041024,...\n6    -0.5486589 0.8742013 POLYGON ((-196727 9888805, ...\n```\n\n\n:::\n:::\n\n\n\nUse tmap or ggplot2 to visualize the spatial distribution of the coefficients and R-squared values.\nThis will help you identify spatial patterns in the relationships.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ensure column names in gwr_results match expected names\ncombined_data$prop_MFI_coef <- gwr_results$prop_MFI\ncombined_data$prop_INSURANCE_coef <- gwr_results$prop_INSURANCE\ncombined_data$prop_SACCO_coef <- gwr_results$prop_SACCO\ncombined_data$Local_R2 <- gwr_results$Local_R2\n```\n:::\n\n\n\n**Map the coefficients for each predictor**\n\n::: panel-tabset\n## Map for prop_MFI coefficient\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(combined_data) +\n  tm_polygons(\"prop_MFI_coef\", \n              title = \"GWR Coefficient for MFI Proportion\",\n              palette = \"RdBu\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"Spatial Variation of GWR Coefficient for MFI Proportion\", main.title.size = 1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n**Interpretation**: This map shows the spatial variation in the relationship between the proportion of people using microfinance institutions (MFI) and the proportion of people who are banked.\n\n**Observation**: Regions with higher positive coefficients (blue areas) suggest that, in these areas, higher MFI participation is more strongly associated with banking inclusion.\nThis could indicate that in these regions, microfinance institutions may serve as a stepping stone toward formal banking.\n\n**Implication**: Policymakers in these blue regions might consider strengthening connections between MFIs and traditional banks to further support financial inclusion.\n\n## Map for prop_INSURANCE coefficient\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(combined_data) +\n  tm_polygons(\"prop_INSURANCE_coef\", \n              title = \"GWR Coefficient for Insurance Proportion\",\n              palette = \"RdBu\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"Spatial Variation of GWR Coefficient for Insurance Proportion\", main.title.size = 1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n**Interpretation**: This map visualizes the influence of the proportion of people with insurance on the banking inclusion proportion.\n\n**Observation**: The red regions indicate areas where insurance is less strongly associated with banking inclusion, whereas the blue regions show stronger positive relationships.\n\n**Implication**: In areas where the association is weaker (red areas), it may be beneficial to examine barriers to integrating insurance with banking products.\nConversely, regions with stronger associations (blue areas) could focus on promoting joint insurance and banking products to further financial inclusion.\n\n## Map for prop_SACCO coefficient\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(combined_data) +\n  tm_polygons(\"prop_SACCO_coef\", \n              title = \"GWR Coefficient for SACCO Proportion\",\n              palette = \"RdBu\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"Spatial Variation of GWR Coefficient for SACCO Proportion\", main.title.size = 1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n**Interpretation**: This map indicates the relationship between the proportion of people involved in Savings and Credit Cooperative Organizations (SACCOs) and banking inclusion.\n\n**Observation**: Red regions indicate areas where SACCO participation negatively impacts banking inclusion, while lighter areas show weaker relationships.\nThe negative values could imply that in certain regions, SACCOs might be seen as substitutes for formal banking services rather than complements.\n\n**Implication**: In areas where SACCO participation negatively impacts banking inclusion, there might be opportunities to create pathways or partnerships between SACCOs and formal banks to encourage individuals to access a broader range of financial services.\n\n## Map for Local R-squared values\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(combined_data) +\n  tm_polygons(\"Local_R2\", \n              title = \"Local R-squared\",\n              palette = \"Greens\", \n              style = \"quantile\") +\n  tm_layout(main.title = \"Local R-squared of GWR Model\", main.title.size = 1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n**Interpretation**: This map shows the local R-squared values from the GWR model, indicating how well the model explains the variability in banking inclusion in different regions.\n\n**Observation**: Regions with higher R-squared values (darker green areas) have a better model fit, suggesting that the selected independent variables explain the variation in banking inclusion well in these areas.\nLower R-squared areas may require additional explanatory factors.\n\n**Implication**: For regions with lower R-squared values, further analysis could explore additional variables or factors influencing banking inclusion, as the current model might be missing local contextual factors in these areas.\n:::\n\n## 3.3 Model Validation\n\nWe’ve already mapped local R-squared values, which give insight into how well the model fits in each region.\nNow, we can examine summary statistics or visualize these values to identify areas with stronger or weaker fits.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Summary of Local R-squared values\nsummary(gwr_results$Local_R2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n 0.5498  0.6427  0.7015  0.7121  0.7822  0.8742 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Histogram of Local R-squared values\nlibrary(ggplot2)\nggplot(gwr_results, aes(x = Local_R2)) +\n  geom_histogram(binwidth = 0.05, fill = \"skyblue\", color = \"black\") +\n  labs(title = \"Distribution of Local R-squared Values\", x = \"Local R-squared\", y = \"Frequency\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n::: callout-note\n**Mean Local R-squared:** 0.712, indicating that on average, the model explains about 71.2% of the variance in financial inclusion factors at the local level.\n\n**Median Local R-squared:** 0.7015, with the first and third quartiles at 0.6427 and 0.7822, respectively.\nThis indicates that half of the regions have a Local R-squared between approximately 0.64 and 0.78.\n:::\n\nResiduals analysis from the GWR model can help assess where the model may underestimate or overestimate banking inclusion.\nMapping residuals provides insight into potential spatial patterns in model misfit.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Residual summary\nsummary(gwr_results$residual)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n-0.072437 -0.012753  0.004912  0.007246  0.021738  0.119104 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Adding residuals to combined_data for mapping\ncombined_data$residual <- gwr_results$residual\n\n# Map residuals\nlibrary(tmap)\ntm_shape(combined_data) +\n  tm_polygons(\"residual\", title = \"GWR Model Residuals\", palette = \"RdBu\", style = \"quantile\") +\n  tm_layout(main.title = \"Spatial Distribution of GWR Residuals\", main.title.size = 1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n::: callout-note\n**Red-shaded regions**: These are areas where the GWR model’s predictions are higher than observed values, indicating potential overestimation.\nThis may suggest that the model attributes higher financial inclusion here than what exists, possibly due to a lack of local adjustment in these areas.\n\n**Blue-shaded regions**: These areas have positive residuals, meaning the GWR model underestimates financial inclusion here.\nThis underestimation may indicate unobserved local factors that enhance financial inclusion more than expected by the model’s structure.\n:::\n\n## 3.4 Interpretation of T-value\n\nWe’ll look at the statistical significance of the coefficients for each predictor variable (prop_MFI, prop_INSURANCE, prop_SACCO) to understand where each factor has the strongest or weakest effect on banking inclusion.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check if T-values for each coefficient exist in gwr_results and add them to combined_data\n\nt_value_columns <- c(\"prop_MFI_TV\", \"prop_INSURANCE_TV\", \"prop_SACCO_TV\")\n\n# Loop through each T-value column and add to combined_data if it exists in gwr_results\nfor (col_name in t_value_columns) {\n  if (col_name %in% colnames(gwr_results)) {\n    combined_data[[col_name]] <- gwr_results[[col_name]]\n  } else {\n    warning(paste(\"The column\", col_name, \"does not exist in gwr_results\"))\n  }\n}\n```\n:::\n\n\n\n::: panel-tabset\nDefine breaks for significance levels\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt_value_breaks <- c(-2, -1.96, 0, 1.96, 2)\n```\n:::\n\n\n\n## T-values for prop_MFI\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(combined_data) +\n  tm_polygons(\"prop_MFI_TV\", title = \"T-value for MFI Proportion\", \n              palette = \"RdBu\", style = \"fixed\", breaks = t_value_breaks) +\n  tm_layout(main.title = \"Statistical Significance of MFI Coefficient\", main.title.size = 1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n-   This map shows the significance of the MFI coefficient, with areas where the relationship is statistically significant highlighted in darker colors.\n\n-   Regions in light colors may indicate non-significant relationships, where MFI involvement has a negligible effect on financial inclusion.\n\n## T-values for prop_INSURANCE\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(combined_data) +\n  tm_polygons(\"prop_INSURANCE_TV\", title = \"T-value for Insurance Proportion\", \n              palette = \"RdBu\", style = \"fixed\", breaks = t_value_breaks) +\n  tm_layout(main.title = \"Statistical Significance of Insurance Coefficient\", main.title.size = 1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n-   The T-value map for insurance displays the statistical significance of the relationship between insurance coverage and financial inclusion.\n\n-   Areas in darker shades indicate statistically significant relationships, while lighter shades show regions where the effect of insurance on financial inclusion is not significant.\n\n## T-values for prop_SACCO\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(combined_data) +\n  tm_polygons(\"prop_SACCO_TV\", title = \"T-value for SACCO Proportion\", \n              palette = \"RdBu\", style = \"fixed\", breaks = t_value_breaks) +\n  tm_layout(main.title = \"Statistical Significance of SACCO Coefficient\", main.title.size = 1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n-   The SACCO T-value map similarly highlights the significance of the SACCO coefficient across regions.\n\n-   Blue areas indicate statistically significant positive relationships, showing where SACCO membership contributes more strongly to financial inclusion.\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}